# Stream Kinesis Data to CloudWatch Using Terraform

The monitoring team wants to improve observability into the streaming infrastructure. Your task is to implement a solution using Amazon Kinesis and CloudWatch. The team wants to ensure that if write throughput exceeds provisioned limits, an alert is triggered immediately.

As a member of the Nautilus DevOps Team, perform the following tasks using Terraform:

1. Create a Kinesis Data Stream: Name the stream `datacenter-kinesis-stream` with a shard count of `1`.

2. Enable Monitoring: Enable shard-level metrics for the stream to track ingestion and throughput errors.

3. Create a CloudWatch Alarm: Name the alarm `datacenter-kinesis-alarm` and monitor the `WriteProvisionedThroughputExceeded` metric. The alarm should trigger if the metric exceeds a threshold of 1.

4. Ensure Alerting: Configure the CloudWatch alarm to detect write throughput issues exceeding provisioned limits.

5. Create the main.tf file (do not create a separate `.tf` file) to provision the Kinesis stream, CloudWatch alarm, and ensure alerting.

6. Create the outputs.tf file with the following variable names to output:

   - `kke_kinesis_stream_name` for the Kinesis stream name.
   - `kke_kinesis_alarm_name` for the CloudWatch alarm name.


**`/home/bob/terraform/main.tf`**

```hcl
resource "aws_kinesis_stream" "datacenter_stream" {
  name             = "datacenter-kinesis-stream"
  shard_count      = 1
  retention_period = 24

  shard_level_metrics = [
    "IncomingBytes",
    "IncomingRecords",
    "WriteProvisionedThroughputExceeded",
    "ReadProvisionedThroughputExceeded",
    "OutgoingBytes",
    "OutgoingRecords"
  ]

  tags = {
    Name = "datacenter-kinesis-stream"
  }
}

resource "aws_cloudwatch_metric_alarm" "datacenter_kinesis_alarm" {
  alarm_name          = "datacenter-kinesis-alarm"
  comparison_operator = "GreaterThanThreshold"
  evaluation_periods  = 1
  metric_name         = "WriteProvisionedThroughputExceeded"
  namespace           = "AWS/Kinesis"
  period              = 60
  statistic           = "Sum"
  threshold           = 1
  treat_missing_data  = "notBreaching"

  dimensions = {
    StreamName = aws_kinesis_stream.datacenter_stream.name
  }

  alarm_description = "Alarm when Kinesis write throughput exceeds provisioned limits"
}
```

**`/home/bob/terraform/outputs.tf`**


```hcl
output "kke_kinesis_stream_name" {
  value = aws_kinesis_stream.datacenter_stream.name
}

output "kke_kinesis_alarm_name" {
  value = aws_cloudwatch_metric_alarm.datacenter_kinesis_alarm.alarm_name
}
```

## How to apply

```bash
terraform init
terraform apply -auto-approve
terraform plan
```
