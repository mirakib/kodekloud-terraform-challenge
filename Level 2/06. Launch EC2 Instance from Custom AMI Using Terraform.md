# Launch EC2 Instance from Custom AMI Using Terraform

The Nautilus DevOps team needs to create an AMI from an existing EC2 instance for backup and scaling purposes. The following steps are required:

1. They have an existing EC2 instance named `xfusion-ec2`.
2. They need to create an AMI named `xfusion-ec2-ami` from this instance.
3. Additionally, they need to launch a new EC2 instance named `xfusion-ec2-new` using this AMI.

4. Update the `main.tf` file (do not create a different or separate `.tf` file) to provision an AMI and then launch an EC2 Instance from that AMI.

5. Create an outputs.tf file to output the following values:
   - `KKE_ami_id` for the AMI ID you created.
   - `KKE_new_instance_id` for the EC2 instance ID you created.

**`/home/bob/terraform/main.tf`**

```hcl
# Provision EC2 instance
resource "aws_instance" "ec2" {
  ami           = "ami-0c101f26f147fa7fd"
  instance_type = "t2.micro"

  vpc_security_group_ids = [
    "sg-5d7669372c1c68df1"
  ]

  tags = {
    Name = "xfusion-ec2"
  }
}

# Create AMI from existing EC2 instance
resource "aws_ami_from_instance" "xfusion_ami" {
  name               = "xfusion-ec2-ami"
  source_instance_id = aws_instance.ec2.id

  tags = {
    Name = "xfusion-ec2-ami"
  }

  depends_on = [aws_instance.ec2]
}

# Launch new EC2 instance using the created AMI
resource "aws_instance" "xfusion_new" {
  ami                    = aws_ami_from_instance.xfusion_ami.id
  instance_type          = "t2.micro"
  vpc_security_group_ids = [
    "sg-5d7669372c1c68df1"
  ]

  tags = {
    Name = "xfusion-ec2-new"
  }

  depends_on = [aws_ami_from_instance.xfusion_ami]
}
```

**`/home/bob/terraform/outputs.tf`**

```hcl
output "KKE_ami_id" {
  value = aws_ami_from_instance.xfusion_ami.id
}

output "KKE_new_instance_id" {
  value = aws_instance.xfusion_new.id
}
```

## How to apply

```bash
terraform apply -auto-approve
terraform plan
```
